<!DOCTYPE html>
<html>
 <head>
    <title>Vikter</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript" src="csv.js"></script>
    <link rel="stylesheet" href="d3.slider.css" />  

    <style>

        body {
          font-family: Verdana,Arial,sans-serif;
        }

        h2 {
          font-size: 0.8em;
          margin: 5px 0 5px 0;
        }

        .wrapper {
          width: 40%;
          margin-left: auto;
          margin-right: auto;
          float: right;
        }

        .wrapper > div {
          margin: 35px 0;
          
        }

        .bottom{
           font-size: 10pt; 
        }

        label {
            float:left;

        }

        #svg{
            width: 1000px;
            height:1000px;
        }

      </style>

    </head>
 </head>
 <body>
<div class="wrapper">
    
    <h2>Date</h2>
    <div id="date"></div>

    <h2>Number of Failed Inspections</h2>
    <div id="failed"></div>

    <h2>Total Inspection Scores</h2>
    <div id="inspectionScore"></div>

    <h2>Total Violation Points</h2>
    <div id="violationPoints"></div>

    <h2>Number of Red Flags</h2>
    <div id="redFlags"></div>

    <h2>Number of Blue Flags</h2>
    <div id="blueFlags"></div>


  </div>

     <button id="prices" value="Prices">Prices</button><br>

    <svg id="svg"></svg>

<div class="bottom">
    <h2>Inspection Type</h2>
    <br>
    <h2>Location Type</h2>
    <div class="desc_options">
      <label><input class="desc_button" value="Seating 13-50 - Risk Category III" type="checkbox" checked>Seating 13-50 - Risk Category III</input></label>
      <label><input class="desc_button" value="Seating 51-150 - Risk Category III" type="checkbox" checked>Seating 51-150 - Risk Category III</input></label>
      <label><input class="desc_button" value="Bed and Breakfast - Risk Category I" type="checkbox" checked>Bed and Breakfast - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating > 250 - Risk Category III" type="checkbox" checked>Seating > 250 - Risk Category III</input></label>
      <label><input class="desc_button" value="Mobile Food Unit - Risk Category I" type="checkbox" checked>Mobile Food Unit - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating 0-12 - Risk Category III" type="checkbox" checked>Seating 0-12 - Risk Category III</input></label>
      <label><input class="desc_button" value="Caterer - Risk Category III" type="checkbox" checked>Caterer - Risk Category III</input></label>
      <label><input class="desc_button" value="Non-Profit Institution - Risk Category I" type="checkbox" checked>Non-Profit Institution - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating 0-12 - Risk Category II" type="checkbox" checked>Seating 0-12 - Risk Category II</input></label>
      <label><input class="desc_button" value="Grocery Store-no seating - Risk Category I" type="checkbox" checked>Grocery Store-no seating - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating 13-50 - Risk Category II" type="checkbox" checked>Seating 13-50 - Risk Category II</input></label>
      <label><input class="desc_button" value="Mobile Food Unit - Risk Category III" type="checkbox" checked>Mobile Food Unit - Risk Category III</input></label>
      <label><input class="desc_button" value="Grocery Store-no seating - Risk Category II" type="checkbox" checked>Grocery Store-no seating - Risk Category II</input></label>
      <label><input class="desc_button" value="Seating 13-50 - Risk Category I" type="checkbox" checked>Seating 13-50 - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating 151-250 - Risk Category III" type="checkbox" checked>Seating 151-250 - Risk Category III</input></label>
      <label><input class="desc_button" value="Seating 0-12 - Risk Category I" type="checkbox" checked>Seating 0-12 - Risk Category I</input></label>
      <label><input class="desc_button" value="Bakery-no seating - Risk Category III" type="checkbox" checked>Bakery-no seating - Risk Category III</input></label>
      <label><input class="desc_button" value="Meat/Sea Food - Risk Category III" type="checkbox" checked>Meat/Sea Food - Risk Category III</input></label>
      <label><input class="desc_button" value="School Lunch Program - Risk II" type="checkbox" checked>School Lunch Program - Risk II</input></label>
      <label><input class="desc_button" value="Bakery-no seating - Risk Category II" type="checkbox" checked>Bakery-no seating - Risk Category II</input></label>
      <label><input class="desc_button" value="Limited Food Services - no permanent plumbing" type="checkbox" checked>Limited Food Services - no permanent plumbing</input></label>
      <label><input class="desc_button" value="Caterer - Risk Category II" type="checkbox" checked>Caterer - Risk Category II</input></label>
      <label><input class="desc_button" value="Non-Profit Institution - Risk Category III" type="checkbox" checked>Non-Profit Institution - Risk Category III</input></label>
      <label><input class="desc_button" value="Seating 51-150 - Risk Category I" type="checkbox" checked>Seating 51-150 - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating > 250 - Risk Category I" type="checkbox" checked>Seating > 250 - Risk Category I</input></label>
      <label><input class="desc_button" value="Non-Profit Institution - Risk Category II" type="checkbox" checked>Non-Profit Institution - Risk Category II</input></label>
      <label><input class="desc_button" value="Seating 51-150 - Risk Category II" type="checkbox" checked>Seating 51-150 - Risk Category II</input></label>
      <label><input class="desc_button" value="Bakery-no seating - Risk Category I" type="checkbox" checked>Bakery-no seating - Risk Category I</input></label>
      <label><input class="desc_button" value="Mobile Food Unit - Risk Category II" type="checkbox" checked>Mobile Food Unit - Risk Category II</input></label>
      <label><input class="desc_button" value="Tasting Room - Exempt from permit" type="checkbox" checked>Tasting Room - Exempt from permit</input></label>
      <label><input class="desc_button" value="Seating 151-250 - Risk Category I" type="checkbox" checked>Seating 151-250 - Risk Category I</input></label>
      <label><input class="desc_button" value="Seating 151-250 - Risk Category II" type="checkbox" checked>Seating 151-250 - Risk Category II</input></label>
      <label><input class="desc_button" value="Caterer - Risk Category I" type="checkbox" checked>Caterer - Risk Category I</input></label>
      <label><input class="desc_button" value="Tasting Room - Exempt from code" type="checkbox" checked>Tasting Room - Exempt from code</input></label>
    </div>
</div>
    <script src="d3.slider.js"></script>
    <script type="text/javascript">


    var width = 1000,
    height = 1000;
    var arrays = [];
    var jsonCircles = [
       { "x_axis": 900, "y_axis": 900, "radius": 3, "color" : "green" },
       { "x_axis": 30, "y_axis": 30, "radius": 3, "color" : "purple"},
       { "x_axis": 450, "y_axis": 450, "radius": 3, "color" : "red"}];
 
    var svgContainer = d3.select('#svg').append('svg')
    .attr('width', width)
    .attr('height', height);


    function latit(lt) {
       return 1000 - (lt%47.6)*10000 * 1.4
    }

    function longit(ln) {
        return 1000 + (ln%-122.27) * 10000 * 1.5
    }

    d3.select("#prices").on("click", function(d,i)
    {
        if(arrays.length == 0) {
            d3.csv("data.csv", function(data) {
                data.forEach(function(d) {
                {
                    var found = false;
                    var index = 0;
                    var inspection = {"Program_Identifier":d["Program Identifier"], "Inspection_Date": d["Inspection Date"], "Inspection_Type": d["Inspection Type"], "Inspection_Score":d["Inspection Score"], "Inspection_Result" : d["Inspection Result"], "Violation_Type" : d["Violation Type"]};
                    while(!found && index < arrays.length) {
                      //console.log(arrays[index].Name+" vs "+d["Name"]);
                      if(arrays[index].Name === d["Name"]) {
                        found = true;
                        //console.log(arrays.length);
                        arrays[index].inspections.push(inspection);
                      }
                      index++;
                    }
                    if(!found) {
                      arrays.push({ "Name": d["Name"], "Latitude": d["Latitude"], "Longitude": d["Longitude"], "Description" : d["Description"] , "Address": d["Address"], "Phone": d["Phone"], inspections:[inspection]});
                      console.log("HUEHUEHUE");
                    }
              }
            });
            });

        }
        else {
            var circles = svgContainer.selectAll("circle")
                          .data(arrays)
                          .enter()
                          .append("circle");

            var circleAttributes = circles
                            .attr("cx", function (d) { return longit(d.Longitude); })
                            .attr("cy", function (d) { return latit(d.Latitude) + 5; })
                            .attr("r", function (d) { return 3; })
                            .style("stroke", "black")
                            .style("fill", "green");
        }
        console.log(arrays);
    })
        //init();
    </script>
    
    <script>
    /*
        Sliders and checkboxes
    */

    //array stuff
    //for the first 12 indexes they are the values of the sliders
    var currentValues = [2006,2016,0,10,0,100,0,500,0,10,0,10];
    var currentBoxes = ["1Seating 13-50 - Risk Category III","1Seating 51-150 - Risk Category III","1Bed and Breakfast - Risk Category I","1Seating > 250 - Risk Category III","1Mobile Food Unit - Risk Category I","1Seating 0-12 - Risk Category III","1Caterer - Risk Category III","1Non-Profit Institution - Risk Category I","1Seating 0-12 - Risk Category II","1Grocery Store-no seating - Risk Category I","1Seating 13-50 - Risk Category II","1Mobile Food Unit - Risk Category III","1Grocery Store-no seating - Risk Category II","1Seating 13-50 - Risk Category I","1Seating 151-250 - Risk Category III","1Seating 0-12 - Risk Category I","1Bakery-no seating - Risk Category III","1Meat/Sea Food - Risk Category III","1School Lunch Program - Risk II","1Bakery-no seating - Risk Category II","1Limited Food Services - no permanent plumbing","1Caterer - Risk Category II","1Non-Profit Institution - Risk Category III","1Seating 51-150 - Risk Category I","0Seating > 250 - Risk Category I","1Non-Profit Institution - Risk Category II","1Seating 51-150 - Risk Category II","1Bakery-no seating - Risk Category I","1Mobile Food Unit - Risk Category II","1Tasting Room - Exempt from permit","1Seating 151-250 - Risk Category I","1Seating 151-250 - Risk Category II","1Caterer - Risk Category I","1Tasting Room - Exempt from code"]

      //inspection types

      
      //risk categories
      d3.selectAll(".desc_button").on("change", function() {
        var type = this.value;  
        console.log(type + this.checked);
        if(this.checked){
            currentBoxes[currentBoxes.indexOf("0"+type)] = "1"+type;
        } else{
            currentBoxes[currentBoxes.indexOf("1"+type)] = "0"+type;
        }
        console.log(currentBoxes);
      });


      //date
        d3.select('#date').call(d3.slider().scale(d3.time.scale()
        .domain([new Date(2006,1,1), new Date(2016,1,1)]))
        .axis( d3.svg.axis() ).snap(true).value([new Date(2008,1,1),new Date(2010,1,1)])
        .on("slide", function(evt, value) {
          //value[ 0 ]
          console.log(value[0]+value[1]);
          currentValues[0] =value[0];
          currentValues[1] =value[1];
          console.log(currentValues);
          //value[ 1 ]
        }));


      //number of failed inspections - range

      d3.select('#failed').call(d3.slider().axis(true).min(0).max(10).value( [ 0, 10 ] ).on("slide", function(evt, value) {
        //value[ 0 ]
          //value[ 1 ]
          currentValues[2] =value[0];
          currentValues[3] =value[1];
      }));



      //inspection score - range
      d3.select('#inspectionScore').call(d3.slider().axis(true).min(0).max(100).value( [ 0, 100 ] ).on("slide", function(evt, value) {
        //value[ 0 ]
          //value[ 1 ]
          currentValues[4] =value[0];
          currentValues[5] =value[1];
      }));
      //total violation points - range
      d3.select('#violationPoints').call(d3.slider().axis(true).min(0).max(500).value( [ 0, 500 ] ).on("slide", function(evt, value) {
        //value[ 0 ]
          //value[ 1 ]
          currentValues[6] =value[0];
          currentValues[7] =value[1];
      }));
      //number of red flags -  range
      d3.select('#redFlags').call(d3.slider().axis(true).min(0).max(10).value( [ 0, 10 ] ).on("slide", function(evt, value) {
        //value[ 0 ]
          //value[ 1 ]
          currentValues[8] =value[0];
          currentValues[9] =value[1];
      }));
      //number of blue flags -  range
      d3.select('#blueFlags').call(d3.slider().axis(true).min(0).max(10).value( [ 0, 10 ] ).on("slide", function(evt, value) {
        //value[ 0 ]
          //value[ 1 ]
          currentValues[10] =value[0];
          currentValues[11] =value[1];
      }));



  </script>

 </body>
</html>
